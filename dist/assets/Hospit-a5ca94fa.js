import{d as T,r as w,h as V,o as v,c as x,j as s,a as A,w as R,v as I,b as U,k as D,E as q,l as z,H as W,x as Y,t as u,m as S}from"./index-9691e490.js";import{_ as F}from"./Vector2-1f104793.js";import{_ as K}from"./SideBar.vue_vue_type_style_index_0_lang-d158d2d5.js";import{C as $}from"./CustomAlert-50e6fe3f.js";import{P as G,W as Q,g as X,_ as Z}from"./index.esm2017-bebc3d8b.js";const J={class:"container-fluid"},ee={class:"row"},te={class:"col"},oe={class:"row justify-content-center align-items-center"},se={class:"col-md-8 mt-5"},ae=s("nav",{"aria-label":"Breadcrumb"},null,-1),ne={class:"input-group flex-nowrap mt-5"},re=s("span",{class:"input-group-text px-3",id:"addon-wrapping",style:{"border-radius":"2px 0 0 2px"}},[s("i",{class:Y(["fal","fa-search-location"])})],-1),ce=s("div",{id:"map"},null,-1),ie={class:"container pl-5 mt-5"},le=s("h2",{class:"text-gray"},"Nearby Hospitals:",-1),de={class:"row"},pe={class:"card-body pt-5"},ue=["src"],me={class:"card-title mt-2"},ge={class:"card-text"},he={class:"card-text"},_e={class:"card-text"},ve={class:"card-text"},fe={class:"card-text"},be={class:"card-text"},ye=["href"],Pe=T({__name:"Hospit",setup(we){let n,m,h;const d=[],f=w(""),l=w([]),C=async e=>{try{const t=e.filter(o=>o!==void 0);if(t.length>0){const o=G(),a=Q(o);t.forEach(r=>{const{name:p,vicinity:g}=r,i=X(Z(o,"hospitals")),c={name:p,vicinity:g};a.set(i,c)}),await a.commit(),console.log("Hospitals saved to Firebase:",t),window.alert("Hospitals data saved successfully! YAY"),b.value=!0}else console.warn("No valid hospitals data to save."),window.alert("No valid hospitals data to save.")}catch(t){console.error("Error saving hospitals:",t),alert(t)}},b=w(!1),P=async()=>{try{await C(l.value)}catch(e){console.error("Error saving hospitals:",e),alert(e)}},H=()=>{n=new google.maps.Map(document.getElementById("map"),{center:{lat:9.0778,lng:8.6775},zoom:6}),h=new google.maps.places.SearchBox(document.getElementById("search-box"));const e=document.createElement("button");e.textContent="Pan to Current Location",e.classList.add("custom-map-control-button"),n.controls[google.maps.ControlPosition.TOP_CENTER].push(e),e.addEventListener("click",()=>{L()}),m=new google.maps.InfoWindow,n.addListener("bounds_changed",()=>{h.setBounds(n.getBounds())}),h.addListener("places_changed",()=>{const t=h.getPlaces();if(t.length===0)return;d.forEach(a=>a.setMap(null)),d.length=0;const o=new google.maps.LatLngBounds;t.forEach(a=>{if(!a.geometry){console.log("Returned place contains no geometry");return}const r=new google.maps.Marker({map:n,position:a.geometry.location,title:a.name});d.push(r),o.extend(a.geometry.location)}),n.fitBounds(o)})},k=(e,t,o)=>{t.setPosition(o),t.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),t.open(n)},B=()=>{if(f.value){const e={location:n.getCenter(),radius:5e3,keyword:"hospital"};new google.maps.places.PlacesService(n).nearbySearch(e,(o,a)=>{a===google.maps.places.PlacesServiceStatus.OK&&o&&(l.value=o,d.forEach(r=>r.setMap(null)),d.length=0,o.forEach(r=>{if(r.geometry&&r.geometry.location){const p=new google.maps.Marker({map:n,position:r.geometry.location,title:r.name});d.push(p)}}))})}},L=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};m.setPosition(t),m.setContent("Location found."),m.open(n),n.setCenter(t),N(t)},()=>{k(!0,m,n.getCenter())}):k(!1,m,n.getCenter())},M=()=>{const t=(p=>{const g=Object.keys(p[0]).join(",")+`
`,i=p.map(c=>Object.values(c).join(",")+`
`);return g+i.join("")})(l.value),o=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.setAttribute("download","hospitals.csv"),r.click(),alert("Download Successful")},N=e=>{const t={location:e,radius:1e3,type:"hospital",fields:["formatted_phone_number","opening_hours","website"]},o=new google.maps.places.PlacesService(n);o.nearbySearch(t,(a,r)=>{if(r===google.maps.places.PlacesServiceStatus.OK){const g=a.map(i=>i.place_id).map(i=>new Promise(c=>{o.getDetails({placeId:i,fields:["opening_hours"]},(y,_)=>{_===google.maps.places.PlacesServiceStatus.OK?c(y):c(null)})}));Promise.all(g).then(i=>{l.value=a.map((c,y)=>{var _;return{place_id:c.place_id,name:c.name,vicinity:c.vicinity,formatted_phone_number:c.formatted_phone_number,opening_hours:(_=i[y])==null?void 0:_.opening_hours,website:c.website,photoUrl:E(c)}}),C(l.value),clearMarkers(),j(a)})}})},O=e=>!!(e&&e.isOpen()),E=e=>e.photos&&e.photos.length>0?e.photos[0].getUrl({maxWidth:300,maxHeight:300}):"",j=e=>{for(const t of e)if(t.geometry&&t.geometry.location){const o=new google.maps.Marker({position:t.geometry.location,map:n});d.push(o)}};return V(()=>{const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAY2ez0sDkoi-3VjuLN98e1EZRsHHX2RqM&libraries=places&callback=initMap",e.defer=!0,e.async=!0,document.head.appendChild(e),window.initMap=H}),(e,t)=>(v(),x("div",J,[s("div",ee,[A(K),s("div",te,[s("div",oe,[s("div",se,[ae,s("div",ne,[re,R(s("input",{type:"search",class:"form-control p-4",placeholder:"Search hospital",id:"search-box",name:"address","onUpdate:modelValue":t[0]||(t[0]=o=>f.value=o),"aria-describedby":"addon-wrapping",autocomplete:"on",required:"",style:{"border-radius":"0 2px   2px 0"}},null,512),[[I,f.value]]),s("button",{onClick:B,style:{padding:"13px 40px","margin-left":"10px","border-radius":"10px",border:"none"}},"Search")]),ce])]),s("div",ie,[le,s("ul",de,[(v(!0),x(U,null,D(l.value,o=>(v(),x("li",{key:o.place_id,style:{width:"600px"},onSubmit:t[1]||(t[1]=(...a)=>l.value&&l.value(...a))},[s("div",pe,[s("img",{src:E(o),alt:"Hospital Photo",style:{"border-radius":"10px",width:"10rem",height:"10rem"}},null,8,ue),s("h5",me,u(o.name),1),s("p",ge,u(o.vicinity),1),s("p",he,u(o.place_id),1),s("p",_e," Hospital Rating: "+u(o.rating||"No ratings yet"),1),s("p",ve,"Phone Number: "+u(o.formatted_phone_number||"Not Available"),1),s("p",fe,"Opening Hours: "+u(O(o.opening_hours)?"Open":"Closed"),1),s("p",be,[S("Website: "),s("a",{href:o.website,target:"_blank"},u(o.website||"Not Available"),9,ye)]),s("img",{src:F,onClick:M,style:{width:"25px",height:"25px"}})])],32))),128)),b.value?(v(),q($,{key:0,onClose:t[2]||(t[2]=o=>b.value=!1)},{default:z(()=>[S(" Hospitals data saved successfully! ")]),_:1})):W("",!0)]),s("div",{class:"text-center"},[s("button",{onClick:P,class:"btn btn-primary p-3 btn-lg"},"Save Hospitals")])])])])]))}});export{Pe as default};
